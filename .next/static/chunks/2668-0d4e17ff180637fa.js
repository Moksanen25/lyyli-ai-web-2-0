"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2668],{32668:function(e,t,r){r.d(t,{Z:function(){return k}});var a=r(57437),s=r(2265),n=r(51817),i=r(44743),o=r(12381),l=r(40279),c=r(90314),d=r(93448);let u=s.forwardRef((e,t)=>{let{className:r,children:s,...n}=e;return(0,a.jsxs)(c.fC,{ref:t,className:(0,d.cn)("relative overflow-hidden",r),...n,style:{overscrollBehavior:"contain",...n.style},children:[(0,a.jsx)(c.l_,{className:"h-full w-full rounded-[inherit]",style:{overscrollBehavior:"contain"},children:s}),(0,a.jsx)(h,{}),(0,a.jsx)(c.Ns,{})]})});u.displayName=c.fC.displayName;let h=s.forwardRef((e,t)=>{let{className:r,orientation:s="vertical",...n}=e;return(0,a.jsx)(c.gb,{ref:t,orientation:s,className:(0,d.cn)("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...n,children:(0,a.jsx)(c.q4,{className:"relative flex-1 rounded-full bg-border"})})});h.displayName=c.gb.displayName;var f=r(18752),m=r(18627),p=r(48366),w=r(9815);let g=(0,r(67026).eI)("https://zkyqdwmwignohqujlnxf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpreXFkd213aWdub2hxdWpsbnhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2MjU3MTQsImV4cCI6MjA2MjIwMTcxNH0.gFrKXlpvdzVb4awwnTMKksYDjqx9Z2QRm3eSk2OxhO8"),x=async()=>{try{let{data:e,error:t}=await g.functions.invoke("openai-assistant",{body:{action:"createThread"}});if(t)throw Error("Failed to create thread: ".concat(t.message));return localStorage.setItem("openai_thread_id",e.id),e.id}catch(e){throw console.error("Error creating thread:",e),e}},b=()=>localStorage.getItem("openai_thread_id"),y=async(e,t)=>{try{let{data:r,error:a}=await g.functions.invoke("openai-assistant",{body:{action:"addMessage",data:{threadId:e,message:t}}});if(a)throw Error("Failed to add message: ".concat(a.message));return r}catch(e){throw console.error("Error adding message to thread:",e),e}},v=async e=>{try{let{data:t,error:r}=await g.functions.invoke("openai-assistant",{body:{action:"runAssistant",data:{threadId:e}}});if(r)throw Error("Failed to run assistant: ".concat(r.message));return t}catch(e){throw console.error("Error running assistant:",e),e}},j=async(e,t)=>{try{let{data:r,error:a}=await g.functions.invoke("openai-assistant",{body:{action:"checkRunStatus",data:{threadId:e,runId:t}}});if(a)throw Error("Failed to check run status: ".concat(a.message));return r}catch(e){throw console.error("Error checking run status:",e),e}},N=async e=>{try{let{data:t,error:r}=await g.functions.invoke("openai-assistant",{body:{action:"getMessages",data:{threadId:e}}});if(r)throw Error("Failed to retrieve messages: ".concat(r.message));return t}catch(e){throw console.error("Error getting messages:",e),e}},E=e=>{let{onError:t,onMessageReceived:r}=e,[a,n]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=b();e?n(e):i()},[]);let i=async()=>{try{let e=await x();n(e)}catch(e){console.error("Error initializing thread:",e),t("initThread")}},o=async(e,t)=>{let a;try{for(a=await j(e,t);"completed"!==a.status&&"failed"!==a.status&&"expired"!==a.status;)await new Promise(e=>setTimeout(e,1e3)),a=await j(e,t);if("completed"===a.status){let t=await N(e);if(t.data&&t.data.length>0){let e=t.data.find(e=>"assistant"===e.role);if(e){let t=e.content[0].text.value;r(t)}}}else throw Error("Run ended with status: ".concat(a.status))}catch(e){throw console.error("Error polling run status:",e),e}},l=async e=>{if(!a){t("noThread");return}try{await y(a,e);let t=await v(a);await o(a,t.id)}catch(e){console.error("Error sending message:",e),t("sendMessage")}};return{threadId:a,sendMessage:l}};var k=()=>{let{t:e}=(0,m.$)(),t=(0,p.d)(),[r,c]=(0,s.useState)([{role:"assistant",content:"",timestamp:new Date}]),[d,h]=(0,s.useState)(""),[g,x]=(0,s.useState)(!1),b=(0,s.useRef)(null),{toast:y}=(0,f.p)(),{threadId:v,sendMessage:j}=E({onError:t=>{y({title:e("chat.error.title"),description:e("chat.error.".concat(t)),variant:"destructive"})},onMessageReceived:e=>{c(t=>[...t,{role:"assistant",content:e,timestamp:new Date}]),x(!1)}});(0,s.useEffect)(()=>{c([{role:"assistant",content:e("chat.welcomeMessage"),timestamp:new Date}])},[e]),(0,s.useEffect)(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})},[r]);let N=async e=>{if(e.preventDefault(),!d.trim()||!v)return;let t={role:"user",content:d,timestamp:new Date};c(e=>[...e,t]),h(""),x(!0),j(d)};return(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsx)(u,{className:"flex-grow p-4 h-[calc(100%-80px)]",children:(0,a.jsxs)("div",{className:"space-y-4",children:[r.map((e,r)=>(0,a.jsx)(w.Z,{role:e.role,content:e.content,timestamp:e.timestamp,isMobile:t},r)),(0,a.jsx)("div",{ref:b})]})}),(0,a.jsxs)("form",{onSubmit:N,className:"p-4 border-t flex gap-2",children:[(0,a.jsx)(l.I,{value:d,onChange:e=>h(e.target.value),placeholder:e("chat.inputPlaceholder"),disabled:g,className:"flex-grow"}),(0,a.jsxs)(o.z,{type:"submit",disabled:g||!d.trim(),children:[g?(0,a.jsx)(n.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:e("chat.send")})]})]})]})}},9815:function(e,t,r){var a=r(57437);r(2265);var s=r(27648),n=r(96362),i=r(12381),o=r(18627);t.Z=e=>{let{role:t,content:r,timestamp:l,isMobile:c}=e,{t:d}=(0,o.$)(),u=e=>c?e.replace(/(\S{30})/g,"$1â€‹"):e;return(0,a.jsx)("div",{className:"flex ".concat("user"===t?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[85%] ".concat(c?"break-words":""," rounded-lg p-3 ").concat("user"===t?"bg-primary text-primary-foreground":"bg-muted"),style:{overflowWrap:"break-word",wordBreak:"break-word",hyphens:"auto"},children:[(()=>{let e=/\[CASE_STUDY:([^\]]+)\]/g;if(e.test(r)){e.lastIndex=0;let t=r.split(e);if(t.length>1)return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:u(t[0])}),t[1]&&(0,a.jsx)(s.default,{href:t[1],className:"mt-2 block",children:(0,a.jsxs)(i.z,{variant:"outline",size:"sm",className:"mt-2",children:[(0,a.jsx)(n.Z,{className:"mr-1 h-4 w-4"}),d("chat.caseStudy.view")]})}),t[2]&&(0,a.jsx)("p",{className:"mt-2",children:u(t[2])})]})}return u(r).split("\n").map((e,t)=>e.startsWith("## ")?(0,a.jsx)("h3",{className:"font-bold mt-3 mb-1",children:e.replace("## ","")},t):e.startsWith("# ")?(0,a.jsx)("h2",{className:"font-bold text-lg mt-3 mb-2",children:e.replace("# ","")},t):""===e.trim()?(0,a.jsx)("br",{},t):(0,a.jsx)("p",{className:"mb-2",children:e},t))})(),(0,a.jsx)("p",{className:"text-xs opacity-70 mt-1",children:l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})}},40279:function(e,t,r){r.d(t,{I:function(){return i}});var a=r(57437),s=r(2265),n=r(93448);let i=s.forwardRef((e,t)=>{let{className:r,type:s,...i}=e;return(0,a.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...i})});i.displayName="Input"},48366:function(e,t,r){r.d(t,{d:function(){return s}});var a=r(2265);function s(){let[e,t]=a.useState(void 0);return a.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),r=()=>{t(window.innerWidth<768)};return e.addEventListener("change",r),t(window.innerWidth<768),()=>e.removeEventListener("change",r)},[]),!!e}},18627:function(e,t,r){r.d(t,{$:function(){return i}});var a=r(2265),s=r(79665),n=r(46362);let i=()=>{let e=(0,a.useContext)(s.A);if(void 0===e)throw Error("useTranslation must be used within a LanguageProvider");let{language:t}=e;return{t:e=>{try{let r=e.split("."),a=n.M[t]||n.M.en;for(let t of r)if(a&&"object"==typeof a&&t in a)a=a[t];else{for(let t of(a=n.M.en,r)){if(!a||"object"!=typeof a||!(t in a))return e;a=a[t]}break}return"string"==typeof a?a:e}catch(t){return console.error("Translation error:",t),e}},language:t}}}}]);